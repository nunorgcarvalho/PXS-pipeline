# PXS Pipeline

## Input files:
- `input_data/phenotypes.txt`: on each line, write the name of the phenotypes (according to the coeffs and tally .csv) that an analysis should be performed on
- `input_data/CRFs_table.txt`: table of clinical risk factors for each phenotype
- `input_data/coeffs_V9.csv`: list of XWAS coefficients. Pulled from `/n/groups/patel/yixuan/PXS_multi/all/coeffs_V9.csv`
- `input_data/tally_X_V9.csv`: list of XWAS variables. Pulled from `/n/groups/patel/yixuan/PXS_multi/all/tally_X_V9.csv`
- `input_data/bolt.in_plink_but_not_imputed.FID_IID.978.txt`: list of missing imputed individuals generated by BOLT the first you run it. You can either remain your file to match the `978` number or manually edit the scripts to refernce your specific file. (The `978` in this case refers to how many individuals are in the file, and is automatically named that way by BOLT).
- `input_data/exposures.txt`: is automatically created by `prepare_exp_PXS_CRF.R`

External (path must be manually edited inside respective .R scripts):
- `loc_pheno_full`: path to UKBB phenotype file containing all necessary fields and f.eid. Used in `initial_setup.R`
- `dir_data_showcase`: path to directory containing the files `Data_Dictionary_Showcase.tsv` and `Codings.tsv` downloaded from https://biobank.ctsu.ox.ac.uk/crystal/exinfo.cgi?src=accessing_data_guide. Used in `compute_PXS_LM.R`, `aggregate_results.R`, and `geographical_clustering.R`

## Order of scripts to run (inside code/):
1. `initial_setup.sh`: extracts necessary fields from phenotype file, and initiates scripts that compute the PXS for each phenotype
2. `run_BOLT_PXS.sh`: runs BOLT-LMM and BOLT-REML on the PXSs of the phenotypes
3. `run_BOLT_exposures.sh`: runs BOLT-LMM and BOLT-REML on the exposures of the PXS
4. `run_genCorr_CRFs.sh`: run BOLT-REML (genetic correlation) for each PXS and its disease's clinical risk factors

## Visualizing/Summarizing data (inside code/):
- `aggregate_results.R`: extracts important results from and makes plots of BOLT-REML AND BOLT-LMM data for XWAS diseases and exposures
- `geographical_clustering.R`: calculates ANOVA and saves plots for PXS and exposures per assessment center