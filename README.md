# PXS Pipeline

## Input files:

Inside of `input_data/`
- `phenotypes.txt`: on each line, write the name of the phenotypes that an analysis should be performed on. Right now just T2D
- `CRFs_table.txt`: table of clinical risk factors for each phenotype
- `bolt.in_plink_but_not_imputed.FID_IID.978.txt`: list of missing imputed individuals generated by BOLT the first you run it. You can either remain your file to match the `978` number or manually edit the scripts to refernce your specific file. (The `978` in this case refers to how many individuals are in the file, and is automatically named that way by BOLT).
- `exposures.txt`: is automatically created by `prepare_exp_PXS_CRF.R`

External (path must be manually edited inside respective .R scripts):
- `loc_pheno_full`: path to UKBB phenotype file containing all necessary fields and f.eid. Used in `initial_setup.R`
- `dir_data_showcase`: path to directory containing the files `Data_Dictionary_Showcase.tsv` and `Codings.tsv` downloaded from https://biobank.ctsu.ox.ac.uk/crystal/exinfo.cgi?src=accessing_data_guide. Used in `compute_PXS_LM.R`, `aggregate_results.R`, and `geographical_clustering.R`

## Order of scripts to run (inside `code/`)
1. `initial_setup.sh`: runs the R script `generate_PXS_coeffs.R` and then runs `compute_PXS_LM.R` for each disease
    - `generate_PXS_coeffs.R`: formats the exposures correctly from the UK BioBank and runs an XWAS in order to get the PXS coefficients for chosen diseases
    - `compute_PXS_LM.R`: computes the PXS for all individuals for the disease and saves phenotype file. Also makes a list of associated clinical risk factors, a list of associated exposures, and a list of individuals with missing data for any of those exposures
2. `run_BOLT_exposures.sh`: runs BOLT-LMM and BOLT-REML on each disease-associated exposure
    - `BOLT-LMM`: GWAS
    - `BOLT-REML`: SNP-based heritability estimation. Currently being skipped since genCorr already computes h2 estimate.
3. `run_BOLT_PXS.sh`: runs BOLT-LMM and BOLT-REML on the PXSs of the diseases
    - `BOLT-LMM`: GWAS
    - `BOLT-REML`: SNP-based heritability estimation. Currently being skipped since genCorr already computes h2 estimate.
4. `run_genCorr_CRFs.sh`: run BOLT-REML (genetic correlation) for each PXS and its disease's clinical risk factors
5. `run_genCorr_expos.sh`: run BOLT-REML (genetic correlation) for each PXS's exposures and its disease's clinical risk factors
6. `run_genCorr_MAGIC.sh`: run LDsc genetic correlation for PXS_T2D and 4 MAGIC cohorts phenotypes

## Visualizing/Summarizing data (inside `code/`)
- `aggregate_results.R`: extracts important results from and makes plots of BOLT-REML AND BOLT-LMM data for XWAS diseases and exposures
- `geospatial_autocorrelations.R`: computes multiple geospatial analyses on data using individual coordinate data and Moran's I

## Other code
- `helper_functions.R`: contains R functions used by other R scripts
